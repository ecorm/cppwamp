<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CppWAMP: Remote Procedure Calls</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CppWAMP
   </div>
   <div id="projectbrief">C++11 client library for the WAMP protocol</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_rpc_tutorial.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Remote Procedure Calls </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#autotoc_md18">Calling RPCs</a></li>
<li class="level2"><a href="#autotoc_md19">Call Slots</a></li>
<li class="level2"><a href="#autotoc_md20">Registering Procedures</a></li>
<li class="level2"><a href="#autotoc_md21">Registering Statically-Typed Procedures</a></li>
<li class="level2"><a href="#autotoc_md22">Registering Coroutine Procedures</a></li>
<li class="level2"><a href="#autotoc_md23">Returning an ERROR Response to the Callee</a></li>
<li class="level2"><a href="#autotoc_md24">Capturing an ERROR Response from the Caller</a></li>
<li class="level2"><a href="#autotoc_md25">Scoped Registrations</a></li>
<li class="level2"><a href="#autotoc_md26">Cancelling RPCs</a></li>
</ul>
</ul>
</div>
<div class="textblock"><h2><a class="anchor" id="autotoc_md18"></a>
Calling RPCs</h2>
<p>The <a class="el" href="classwamp_1_1_coro_session.html#a27e1d340844ae71b9ffa0fb51591317a">call</a> operation is used to call remote procedures. It takes a <a class="el" href="classwamp_1_1_rpc.html" title="Contains the procedure URI, options, and payload passed to Session::call.">wamp::Rpc</a> object as a parameter, which contains the following information related to the call:</p>
<ul>
<li>the procedure URI to call,</li>
<li>positional <a class="el" href="classwamp_1_1_variant.html" title="Discriminated union container that represents a JSON value.">wamp::Variant</a> arguments, if applicable,</li>
<li>a <a class="el" href="namespacewamp.html#a2027fe57e4014c013dcbbc733a1c9a56" title="Variant bound type for maps of variants.">wamp::Object</a> containing keyword arguments, if applicable, and,</li>
<li>an <a class="el" href="classwamp_1_1_options.html" title="Represents a collection of WAMP options or details.">wamp::Options</a> dictionary for advanced WAMP features</li>
</ul>
<p><code>call</code> returns a <a class="el" href="classwamp_1_1_result.html" title="Contains a remote procedure result yielded by a callee or received by a caller.">wamp::Result</a> object, which contains the result payload and other details returned by the callee.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacewamp.html">wamp</a>;</div>
<div class="line">boost::asio::spawn(ioctx, [&amp;](boost::asio::yield_context yield)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> session = <a class="code" href="classwamp_1_1_coro_session.html#a60225f83299f06c5bf1ecc3c8713a316">CoroSession&lt;&gt;::create</a>(ioctx, {tcpJson, tcpPack});</div>
<div class="line">    session-&gt;connect(yield);</div>
<div class="line">    session-&gt;join(<span class="stringliteral">&quot;somerealm&quot;</span>, yield);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Call a remote procedure that takes no arguments</span></div>
<div class="line">    <a class="code" href="classwamp_1_1_result.html">Result</a> result = session-&gt;call(<a class="code" href="classwamp_1_1_rpc.html">Rpc</a>(<span class="stringliteral">&quot;getElapsed&quot;</span>), yield);</div>
<div class="line">    <span class="keywordtype">int</span> elapsed = 0;</div>
<div class="line">    result.convertTo(elapsed); <span class="comment">// Will throw error::Conversion</span></div>
<div class="line">                               <span class="comment">// if conversion fails</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;The elapsed number of seconds is &quot;</span> &lt;&lt; elapsed &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Call a remote procedure that takes two positional arguments</span></div>
<div class="line">    <span class="keyword">auto</span> sum = session-&gt;call(<a class="code" href="classwamp_1_1_rpc.html">Rpc</a>(<span class="stringliteral">&quot;add&quot;</span>).withArgs(12, 34), yield);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;12 + 34 is &quot;</span> &lt;&lt; sum[0] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Call a remote procedure that takes a single keyword argument and</span></div>
<div class="line">    <span class="comment">// does not return any result. Also enable the &#39;disclose_me&#39;</span></div>
<div class="line">    <span class="comment">// advanced feature.</span></div>
<div class="line">    session-&gt;call( <a class="code" href="classwamp_1_1_rpc.html">Rpc</a>(<span class="stringliteral">&quot;setProperties&quot;</span>).withKwargs({{<span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;John&quot;</span>}})</div>
<div class="line">                                       .withDiscloseMe(),</div>
<div class="line">                   yield );</div>
<div class="line">});</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md19"></a>
Call Slots</h2>
<p>CppWamp allows you to register callback functions that will be executed whenever a procedure with a certain name is invoked remotely by a dealer. Such callback functions are named <em>call slots</em>. Call slots can be any callable entity that can be stored into a <a href="http://en.cppreference.com/w/cpp/utility/functional/function"><code>std::function</code></a>:</p><ul>
<li>free functions,</li>
<li>member functions (via <a href="http://en.cppreference.com/w/cpp/utility/functional/bind"><code>std::bind</code></a>),</li>
<li>function objects,</li>
<li>lambdas, etc.</li>
</ul>
<h2><a class="anchor" id="autotoc_md20"></a>
Registering Procedures</h2>
<p><a class="el" href="classwamp_1_1_coro_session.html#a6081368ea20971cd258ece70f3ca6b28">enroll()</a> is used to register a remote procedure call slot: </p><div class="fragment"><div class="line">Registration reg = session-&gt;enroll(Procedure(<span class="stringliteral">&quot;name&quot;</span>), slot, yield);</div>
</div><!-- fragment --><p>where:</p><ul>
<li><a class="el" href="classwamp_1_1_registration.html">Registration</a> is a lightweight object that can be later used to unregister the procedure,</li>
<li><a class="el" href="classwamp_1_1_procedure.html">Procedure</a> is an object containing the procedure URI, plus other optional information related to advanced WAMP features, and,</li>
<li><code>slot</code> is the handler function to be invoked for the registered RPC.</li>
</ul>
<p><code>enroll</code> expects a call slot with the following signature: </p><div class="fragment"><div class="line"><a class="code" href="classwamp_1_1_outcome.html">wamp::Outcome</a> <span class="keyword">function</span>(<a class="code" href="classwamp_1_1_invocation.html">wamp::Invocation</a>)</div>
</div><!-- fragment --><p>where:</p><ul>
<li><a class="el" href="classwamp_1_1_outcome.html" title="Contains the outcome of an RPC invocation.">wamp::Outcome</a> contains a <a class="el" href="classwamp_1_1_result.html" title="Contains a remote procedure result yielded by a callee or received by a caller.">wamp::Result</a> or a <a class="el" href="classwamp_1_1_error.html" title="Provides the reason URI, options, and payload arguments contained within WAMP ERROR messages.">wamp::Error</a> object to be sent back to the caller, and,</li>
<li><a class="el" href="classwamp_1_1_invocation.html" title="Contains payload arguments and other details related to a remote procedure call invocation.">wamp::Invocation</a> is an object containing information and payload arguments related to the RPC invocation.</li>
</ul>
<p>Example: </p><div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacewamp.html">wamp</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classwamp_1_1_outcome.html">Outcome</a> addToCart(<a class="code" href="classwamp_1_1_invocation.html">Invocation</a> inv)</div>
<div class="line">{</div>
<div class="line">    std::string item;</div>
<div class="line">    <span class="keywordtype">int</span> cost;</div>
<div class="line">    inv.<a class="code" href="classwamp_1_1_payload.html#ac0611ccca2da85479e1e8ac9b9a1618a">args</a>().convertTo(item, cost); <span class="comment">// throws if conversions fail</span></div>
<div class="line">    <span class="comment">// Process invocation...</span></div>
<div class="line">    <span class="keywordtype">int</span> total = ...</div>
<div class="line">    <span class="keywordflow">return</span> {total}; <span class="comment">// Send a single positional argument back to the caller</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Within coroutine</span></div>
<div class="line"><span class="keyword">auto</span> reg = session-&gt;enroll(</div>
<div class="line">    <a class="code" href="classwamp_1_1_procedure.html">Procedure</a>(<span class="stringliteral">&quot;addToCart&quot;</span>).withDiscloseCaller(),</div>
<div class="line">    &amp;addToCart,</div>
<div class="line">    yield);</div>
<div class="line"><span class="comment">// :::</span></div>
<div class="line"><span class="comment">// Unregistering</span></div>
<div class="line">reg.unregister();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21"></a>
Registering Statically-Typed Procedures</h2>
<p>Certain remote procedures may expect a fixed number of statically-typed arguments. For these situations, the <a class="el" href="classwamp_1_1_basic_invocation_unpacker.html#acc12b68f16f72414281b4e12ff042086">wamp::basicRpc</a> template function can be used: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="unpacker_8hpp.html">cppwamp/unpacker.hpp</a>&gt;</span></div>
<div class="line"><span class="comment">// :::</span></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacewamp.html">wamp</a>;</div>
<div class="line"><a class="code" href="classwamp_1_1_registration.html">Registration</a> reg =</div>
<div class="line">    session-&gt;enroll(<a class="code" href="classwamp_1_1_procedure.html">Procedure</a>(<span class="stringliteral">&quot;name&quot;</span>),</div>
<div class="line">                    basicRpc&lt;ReturnType, StaticTypeList...&gt;(slot),</div>
<div class="line">                    yield);</div>
</div><!-- fragment --><p>where:</p><ul>
<li><em>ReturnType</em> is the type returned by the RPC (may be <code>void</code>)</li>
<li><em>StaticTypeList...</em> is a parameter pack of static types</li>
<li><em>slot</em> has the signature: ``` ReturnType function(StaticTypeList...) ```</li>
</ul>
<p>Example: </p><div class="fragment"><div class="line"><span class="keywordtype">float</span> sum(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> x + y;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Within coroutine</span></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacewamp.html">wamp</a>;</div>
<div class="line">session-&gt;enroll(<a class="code" href="classwamp_1_1_procedure.html">Procedure</a>(<span class="stringliteral">&quot;sum&quot;</span>),</div>
<div class="line">                basicRpc&lt;float, float, float&gt;(&amp;sum), yield);</div>
<div class="line"><span class="comment">//                       ^^^^^^^^^^^^^^^^^^^</span></div>
<div class="line"><span class="comment">//  Note that these types match the ones in the &#39;sum&#39; signature</span></div>
<div class="line"><span class="comment">//  (return type + parameters).</span></div>
</div><!-- fragment --><p>If the <code><a class="el" href="classwamp_1_1_invocation.html" title="Contains payload arguments and other details related to a remote procedure call invocation.">wamp::Invocation</a></code> object is required within a statically-typed RPC, or if the RPC must return a <code><a class="el" href="classwamp_1_1_outcome.html" title="Contains the outcome of an RPC invocation.">wamp::Outcome</a></code>, then the <a class="el" href="classwamp_1_1_invocation_unpacker.html#a87bb179c90a4278ff5f14319da09fb5c">wamp::unpackedRpc</a> template function can be used instead: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="unpacker_8hpp.html">cppwamp/unpacker.hpp</a>&gt;</span></div>
<div class="line"><span class="comment">// :::</span></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacewamp.html">wamp</a>;</div>
<div class="line"><a class="code" href="classwamp_1_1_registration.html">Registration</a> reg = session-&gt;enroll(<a class="code" href="classwamp_1_1_procedure.html">Procedure</a>(<span class="stringliteral">&quot;name&quot;</span>),</div>
<div class="line">                                   unpackedRpc&lt;StaticTypeList...&gt;(slot),</div>
<div class="line">                                   yield);</div>
</div><!-- fragment --><p>where:</p><ul>
<li><em>StaticTypeList...</em> is a parameter pack of static types</li>
<li><em>slot</em> has the signature: <div class="fragment"><div class="line"><a class="code" href="classwamp_1_1_outcome.html">wamp::Outcome</a> <span class="keyword">function</span>(<a class="code" href="classwamp_1_1_invocation.html">wamp::Invocation</a>, StaticTypeList...)</div>
</div><!-- fragment --></li>
</ul>
<p>Example: </p><div class="fragment"><div class="line">Outcome sum(Invocation inv, <span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> {x + y};</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Within coroutine</span></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacewamp.html">wamp</a>;</div>
<div class="line">session-&gt;enroll(<a class="code" href="classwamp_1_1_procedure.html">Procedure</a>(<span class="stringliteral">&quot;sum&quot;</span>),</div>
<div class="line">                unpackedRpc&lt;float, float&gt;(&amp;sum), yield);</div>
<div class="line"><span class="comment">//                          ^^^^^^^^^^^^</span></div>
<div class="line"><span class="comment">//  Note that these types match the ones in the &#39;sum&#39; signature</span></div>
<div class="line"><span class="comment">//  (following the Invocation parameter).</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md22"></a>
Registering Coroutine Procedures</h2>
<p>If the remote procedure must perform it's work in an asynchronous fashion within the context of a coroutine, then <a class="el" href="classwamp_1_1_basic_coro_invocation_unpacker.html#a066b87306bcd89ea54edf67d65e6295f">wamp::basicCoroRpc</a> or <a class="el" href="classwamp_1_1_coro_invocation_unpacker.html#aa2879f55e9df633da8185e80f3c7428f">wamp::unpackedCoroRpc</a> may be used:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacewamp.html">wamp</a>;</div>
<div class="line"> </div>
<div class="line">std::string getName(std::string <span class="keywordtype">id</span>, boost::asio::yield_context yield)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Perform asynchronous operation within RPC handler</span></div>
<div class="line">    <span class="keyword">auto</span> result = session-&gt;call(<a class="code" href="classwamp_1_1_rpc.html">Rpc</a>(<span class="stringliteral">&quot;db.lookup&quot;</span>).withArgs(<span class="keywordtype">id</span>), yield);</div>
<div class="line">    <span class="keywordflow">return</span> result.kwargs[<span class="stringliteral">&quot;name&quot;</span>];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Within coroutine</span></div>
<div class="line">session-&gt;enroll(<a class="code" href="classwamp_1_1_procedure.html">Procedure</a>(<span class="stringliteral">&quot;getName&quot;</span>),</div>
<div class="line">                basicCoroRpc&lt;std::string, std::string&gt;(&amp;getName),</div>
<div class="line">                yield);</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>This will spawn a new coroutine every time the RPC is invoked.</dd></dl>
<h2><a class="anchor" id="autotoc_md23"></a>
Returning an ERROR Response to the Callee</h2>
<p>A <a class="el" href="classwamp_1_1_error.html" title="Provides the reason URI, options, and payload arguments contained within WAMP ERROR messages.">wamp::Error</a> object can be returned from a call slot, which results in an <code>ERROR</code> message being sent back to the callee. This would be used, for example, when invalid arguments are passed to a remote procedure:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacewamp.html">wamp</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classwamp_1_1_outcome.html">Outcome</a> addToCart(<a class="code" href="classwamp_1_1_invocation.html">Invocation</a> inv)</div>
<div class="line">{</div>
<div class="line">    std::string item;</div>
<div class="line">    <span class="keywordtype">int</span> cost = 0;</div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">        inv.<a class="code" href="classwamp_1_1_payload.html#ac0611ccca2da85479e1e8ac9b9a1618a">args</a>().convertTo(item, cost);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="structwamp_1_1error_1_1_conversion.html">error::Conversion</a>&amp; e)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Send an ERROR back to caller</span></div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="classwamp_1_1_error.html">Error</a>(<span class="stringliteral">&quot;wamp.error.invalid_argument&quot;</span>)</div>
<div class="line">                     .<a class="code" href="classwamp_1_1_payload.html#aa4b2975fe591e4fe69720904e6028f5e">withArgs</a>(<span class="stringliteral">&quot;expected [String, Int] arguments&quot;</span>) );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Process invocation...</span></div>
<div class="line">    <span class="keywordtype">int</span> total = computeTotal(currentTotal, item, cost);</div>
<div class="line">    <span class="keywordflow">return</span> {total}; <span class="comment">// Send result back to caller</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Alternatively, you can throw an <code>Error</code> object from a call slot: </p><div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacewamp.html">wamp</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classwamp_1_1_outcome.html">Outcome</a> addToCart(<a class="code" href="classwamp_1_1_invocation.html">Invocation</a> inv)</div>
<div class="line">{</div>
<div class="line">    std::string item;</div>
<div class="line">    <span class="keywordtype">int</span> cost = 0;</div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">        inv.<a class="code" href="classwamp_1_1_payload.html#ac0611ccca2da85479e1e8ac9b9a1618a">args</a>().convertTo(item, cost);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="structwamp_1_1error_1_1_conversion.html">error::Conversion</a>&amp; e)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Send an ERROR back to caller</span></div>
<div class="line">        <span class="keywordflow">throw</span> <a class="code" href="classwamp_1_1_error.html">Error</a>(<span class="stringliteral">&quot;wamp.error.invalid_argument&quot;</span>)</div>
<div class="line">                     .<a class="code" href="classwamp_1_1_payload.html#aa4b2975fe591e4fe69720904e6028f5e">withArgs</a>(<span class="stringliteral">&quot;expected [String, Int] arguments&quot;</span>) );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Process invocation...</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> total = computeTotal(currentTotal, item, cost);</div>
<div class="line">    <span class="keywordflow">return</span> {total}; <span class="comment">// Send result back to caller</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md24"></a>
Capturing an ERROR Response from the Caller</h2>
<p>When calling an RPC, <code>ERROR</code> messages returned by the caller can be captured via the <code><a class="el" href="classwamp_1_1_rpc.html#a0fefbcb96fc3825fefb4d947701d93ab" title="Specifies the Error object in which to store call errors returned by the callee.">wamp::Rpc::captureError</a></code> option:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacewamp.html">wamp</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classwamp_1_1_error.html">Error</a> error;</div>
<div class="line"><span class="keywordflow">try</span></div>
<div class="line">{</div>
<div class="line">    session-&gt;call(<a class="code" href="classwamp_1_1_rpc.html">Rpc</a>(<span class="stringliteral">&quot;foo&quot;</span>).withArgs(42)</div>
<div class="line">                            .captureError(error),</div>
<div class="line">                  yield);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">catch</span> (<a class="code" href="classwamp_1_1error_1_1_failure.html">error::Failure</a>&amp; e)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (!error)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Got error URI: &quot;</span> &lt;&lt; error.reason() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot;with args: &quot;</span> &lt;&lt; error.args() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md25"></a>
Scoped Registrations</h2>
<p>A <a class="el" href="classwamp_1_1_scoped_registration.html" title="Limits a Registration&#39;s lifetime to a particular scope.">wamp::ScopedRegistration</a> object can be used to limit an RPC registration's lifetime to a particular scope. When a <code>ScopedRegistration</code> object is destroyed, it automatically unregisters the registration. This helps in automating the lifetime management of RPC registrations using <a href="https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization">RAII</a> techniques.</p>
<p>Here's an example illustrating how <code>ScopedRegistration</code> can be used to manage the lifetime of a registration:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacewamp.html">wamp</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Delegate</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classwamp_1_1_outcome.html">Outcome</a> rpc(<a class="code" href="classwamp_1_1_invocation.html">Invocation</a> inv);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classwamp_1_1_scoped_registration.html">ScopedRegistration</a> reg;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="namespacewamp.html#a9dd954da85bf9033739185b3a29e3e85">AsioContext</a> ioctx;</div>
<div class="line">    boost::asio::spawn(ioctx, [&amp;](boost::asio::yield_context yield)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> session = <a class="code" href="classwamp_1_1_coro_session.html#a60225f83299f06c5bf1ecc3c8713a316">CoroSession&lt;&gt;::create</a>(connectorList);</div>
<div class="line">        session-&gt;connect(yield);</div>
<div class="line">        session-&gt;join(<span class="stringliteral">&quot;somerealm&quot;</span>, yield);</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">using</span> std::placeholders;</div>
<div class="line">            Delegate delegate;</div>
<div class="line">            delegate.reg = session-&gt;enroll(</div>
<div class="line">                            <a class="code" href="classwamp_1_1_procedure.html">Procedure</a>(<span class="stringliteral">&quot;someprocedure&quot;</span>),</div>
<div class="line">                            std::bind(&amp;Delegate::rpc, delegate, _1),</div>
<div class="line">                            yield);</div>
<div class="line"> </div>
<div class="line">        }  <span class="comment">// When the &#39;delegate&#39; object leaves this scope, its</span></div>
<div class="line">           <span class="comment">// ScopedRegisration member gets destroyed. This will</span></div>
<div class="line">           <span class="comment">// automatically unregister the registration, thereby avoiding</span></div>
<div class="line">           <span class="comment">// further member function calls on the deleted &#39;delegate&#39;</span></div>
<div class="line">           <span class="comment">// object.</span></div>
<div class="line">    });</div>
<div class="line">    ioctx.run();</div>
<div class="line">}</div>
</div><!-- fragment --><p>For a more in-depth discussion on registrations, consult the <a class="el" href="_registrations.html">Registrations</a> page.</p>
<h2><a class="anchor" id="autotoc_md26"></a>
Cancelling RPCs</h2>
<p>If supported by the router, a caller may cancel an RPC in progress via the session's <a class="el" href="classwamp_1_1_session.html#a55304cfcbe2c9db2d98ca55424400d72">cancel</a> method.</p>
<p>A callee wanting to make an RPC interruptible may pass an additional <a class="el" href="classwamp_1_1_session.html#a86a75d8cf69a518de2d6183f55586929">InterruptSlot</a> argument to the <code>enroll</code> method.</p>
<p>Example interruptible callee:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacewamp.html">wamp</a>;</div>
<div class="line"><a class="code" href="namespacewamp.html#a9dd954da85bf9033739185b3a29e3e85">AsioContext</a> ioctx;</div>
<div class="line">boost::asio::deadline_timer timer(ioctx);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classwamp_1_1_outcome.html">Outcome</a> delayedEcho(<a class="code" href="classwamp_1_1_invocation.html">Invocation</a> inv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// This is a poor example because the same timer could be used</span></div>
<div class="line">    <span class="comment">// by multiple invocations before it expires. A more elaborate</span></div>
<div class="line">    <span class="comment">// example would use a scheduler which maps request IDs to</span></div>
<div class="line">    <span class="comment">// deadlines.</span></div>
<div class="line">    boost::asio::spawn(inv.<a class="code" href="classwamp_1_1_invocation.html#a7113343b2fdde3e41f1769a90a60bfdd">executor</a>(),</div>
<div class="line">        [&amp;timer, inv](boost::asio::yield_context yield)</div>
<div class="line">        {</div>
<div class="line">            std::string message;</div>
<div class="line">            int seconds;</div>
<div class="line">            inv.args().convertTo(message, seconds);</div>
<div class="line">            timer.expires_from_now(std::chrono::seconds(seconds);</div>
<div class="line">            boost::system::error_code ec;</div>
<div class="line">            timer.async_wait(yield[ec]);</div>
<div class="line">            if (ec = boost::asio::error::operation_aborted)</div>
<div class="line">                inv.yield(Error{<span class="stringliteral">&quot;myapp.aborted&quot;</span>});</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                inv.<a class="code" href="classwamp_1_1_invocation.html#a5c4de6b58fd50c2d5f5372e740d2b29a">yield</a>(<a class="code" href="classwamp_1_1_result.html">Result</a>{reminder});</div>
<div class="line">        });</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="classwamp_1_1_outcome.html#a52926c1960018ba9769f6fb5d4be4c7d">Outcome::deferred</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> cancelEcho(<a class="code" href="classwamp_1_1_interruption.html">Interruption</a> intr)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// A more elaborate example would use a scheduler that</span></div>
<div class="line">    <span class="comment">// cancels only the operation associated with intr.requestId().</span></div>
<div class="line">    timer.cancel();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> run(<a class="code" href="namespacewamp.html#a9dd954da85bf9033739185b3a29e3e85">AsioContext</a>&amp; ioctx)</div>
<div class="line">{</div>
<div class="line">    boost::asio::spawn(ioctx, [&amp;](boost::asio::yield_context yield)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> session = <a class="code" href="classwamp_1_1_coro_session.html">CoroSession&lt;&gt;::create</a>(ioctx, tcp);</div>
<div class="line">        session-&gt;connect(yield);</div>
<div class="line">        session-&gt;join(<span class="stringliteral">&quot;somerealm&quot;</span>, yield);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Note the additional InterruptSlot argument for enroll.</span></div>
<div class="line">        <span class="keyword">auto</span> reg = session-&gt;enroll(</div>
<div class="line">            <a class="code" href="classwamp_1_1_procedure.html">Procedure</a>(<span class="stringliteral">&quot;remind_me&quot;</span>), &amp;delayedEcho, &amp;cancelEcho, yield);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Etc.</span></div>
<div class="line">    });</div>
<div class="line">}</div>
</div><!-- fragment --><p>Example caller issuing an interruption: </p><div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacewamp.html">wamp</a>;</div>
<div class="line">boost::asio::spawn(ioctx, [&amp;](boost::asio::yield_context yield)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> session = <a class="code" href="classwamp_1_1_coro_session.html#a60225f83299f06c5bf1ecc3c8713a316">CoroSession&lt;&gt;::create</a>(ioctx, tcp);</div>
<div class="line">    session-&gt;connect(yield);</div>
<div class="line">    session-&gt;join(<span class="stringliteral">&quot;somerealm&quot;</span>, yield);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Call a remote procedure that takes a while to respond.</span></div>
<div class="line">    <span class="comment">// Note that the callback-based overload is used, which immediately</span></div>
<div class="line">    <span class="comment">// returns a request ID.</span></div>
<div class="line">    <span class="keyword">auto</span> requestId = session-&gt;call(</div>
<div class="line">        <a class="code" href="classwamp_1_1_rpc.html">Rpc</a>(<span class="stringliteral">&quot;getElapsed&quot;</span>).withArgs(<span class="stringliteral">&quot;hello&quot;</span>, 10),</div>
<div class="line">        [](<a class="code" href="classwamp_1_1_async_result.html">AsyncResult&lt;Result&gt;</a> message)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (message)</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;Message: &quot;</span> &lt;&lt; message.<a class="code" href="classwamp_1_1_async_result.html#a4a9849215f9bc860a606c4fdcf82c1a1">get</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;Error: &quot;</span> &lt;&lt; message.<a class="code" href="classwamp_1_1_async_result.html#a83fd466d9e98afbe22d2bb025314e025">errorInfo</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        });</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Cancel the RPC before it completes.</span></div>
<div class="line">    boost::asio::deadline_timer timer(ioctx, std::chrono::seconds(5));</div>
<div class="line">    timer.async_wait(yield);</div>
<div class="line">    session-&gt;cancel(<a class="code" href="classwamp_1_1_cancellation.html">Cancellation</a>(requestId, <a class="code" href="namespacewamp.html#a5a79c4206c6e45fbfedc0d7d4a775890a534735884d341071762ede7af01c53e8">CancelMode::kill</a>));</div>
<div class="line">});</div>
</div><!-- fragment --><hr  />
<p>Next: <a class="el" href="_pub_sub_tutorial.html">Publish-Subscribe</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aclasswamp_1_1_invocation_html_a7113343b2fdde3e41f1769a90a60bfdd"><div class="ttname"><a href="classwamp_1_1_invocation.html#a7113343b2fdde3e41f1769a90a60bfdd">wamp::Invocation::executor</a></div><div class="ttdeci">AnyExecutor executor() const</div><div class="ttdoc">Obtains the executor used to execute user-provided handlers.</div><div class="ttdef"><b>Definition:</b> sessiondata.ipp:719</div></div>
<div class="ttc" id="aclasswamp_1_1_async_result_html_a4a9849215f9bc860a606c4fdcf82c1a1"><div class="ttname"><a href="classwamp_1_1_async_result.html#a4a9849215f9bc860a606c4fdcf82c1a1">wamp::AsyncResult::get</a></div><div class="ttdeci">ValueType &amp; get()</div><div class="ttdoc">Accesses the asynchronous result value.</div><div class="ttdef"><b>Definition:</b> asyncresult.hpp:151</div></div>
<div class="ttc" id="aclasswamp_1_1_coro_session_html"><div class="ttname"><a href="classwamp_1_1_coro_session.html">wamp::CoroSession</a></div><div class="ttdoc">Coroutine API used by a client peer in WAMP applications.</div><div class="ttdef"><b>Definition:</b> corosession.hpp:94</div></div>
<div class="ttc" id="aclasswamp_1_1_coro_session_html_a60225f83299f06c5bf1ecc3c8713a316"><div class="ttname"><a href="classwamp_1_1_coro_session.html#a60225f83299f06c5bf1ecc3c8713a316">wamp::CoroSession::create</a></div><div class="ttdeci">static Ptr create(AnyExecutor exec, const Connector::Ptr &amp;connector)</div><div class="ttdoc">Creates a new CoroSession instance.</div><div class="ttdef"><b>Definition:</b> corosession.hpp:273</div></div>
<div class="ttc" id="aclasswamp_1_1_invocation_html_a5c4de6b58fd50c2d5f5372e740d2b29a"><div class="ttname"><a href="classwamp_1_1_invocation.html#a5c4de6b58fd50c2d5f5372e740d2b29a">wamp::Invocation::yield</a></div><div class="ttdeci">void yield(Result result=Result()) const</div><div class="ttdoc">Manually sends a YIELD result back to the callee.</div><div class="ttdef"><b>Definition:</b> sessiondata.ipp:774</div></div>
<div class="ttc" id="aclasswamp_1_1_interruption_html"><div class="ttname"><a href="classwamp_1_1_interruption.html">wamp::Interruption</a></div><div class="ttdoc">Contains details related to a remote procedure cancellation.</div><div class="ttdef"><b>Definition:</b> sessiondata.hpp:484</div></div>
<div class="ttc" id="aclasswamp_1_1error_1_1_failure_html"><div class="ttname"><a href="classwamp_1_1error_1_1_failure.html">wamp::error::Failure</a></div><div class="ttdoc">General purpose runtime exception that wraps a std::error_code.</div><div class="ttdef"><b>Definition:</b> error.hpp:52</div></div>
<div class="ttc" id="aclasswamp_1_1_async_result_html"><div class="ttname"><a href="classwamp_1_1_async_result.html">wamp::AsyncResult</a></div><div class="ttdoc">Value type that combines an asynchronous result with an error code.</div><div class="ttdef"><b>Definition:</b> asyncresult.hpp:40</div></div>
<div class="ttc" id="aclasswamp_1_1_error_html"><div class="ttname"><a href="classwamp_1_1_error.html">wamp::Error</a></div><div class="ttdoc">Provides the reason URI, options, and payload arguments contained within WAMP ERROR messages.</div><div class="ttdef"><b>Definition:</b> peerdata.hpp:49</div></div>
<div class="ttc" id="aclasswamp_1_1_procedure_html"><div class="ttname"><a href="classwamp_1_1_procedure.html">wamp::Procedure</a></div><div class="ttdoc">Procedure URI and other options passed to Session::enroll.</div><div class="ttdef"><b>Definition:</b> sessiondata.hpp:226</div></div>
<div class="ttc" id="anamespacewamp_html"><div class="ttname"><a href="namespacewamp.html">wamp</a></div><div class="ttdef"><b>Definition:</b> asiodefs.hpp:22</div></div>
<div class="ttc" id="aunpacker_8hpp_html"><div class="ttname"><a href="unpacker_8hpp.html">unpacker.hpp</a></div><div class="ttdoc">Contains utilities for unpacking positional arguments passed to event slots and call slots.</div></div>
<div class="ttc" id="aclasswamp_1_1_scoped_registration_html"><div class="ttname"><a href="classwamp_1_1_scoped_registration.html">wamp::ScopedRegistration</a></div><div class="ttdoc">Limits a Registration's lifetime to a particular scope.</div><div class="ttdef"><b>Definition:</b> registration.hpp:89</div></div>
<div class="ttc" id="aclasswamp_1_1_async_result_html_a83fd466d9e98afbe22d2bb025314e025"><div class="ttname"><a href="classwamp_1_1_async_result.html#a83fd466d9e98afbe22d2bb025314e025">wamp::AsyncResult::errorInfo</a></div><div class="ttdeci">const std::string &amp; errorInfo() const</div><div class="ttdoc">Returns informational text associated with an error condition.</div><div class="ttdef"><b>Definition:</b> asyncresult.hpp:180</div></div>
<div class="ttc" id="aclasswamp_1_1_rpc_html"><div class="ttname"><a href="classwamp_1_1_rpc.html">wamp::Rpc</a></div><div class="ttdoc">Contains the procedure URI, options, and payload passed to Session::call.</div><div class="ttdef"><b>Definition:</b> sessiondata.hpp:257</div></div>
<div class="ttc" id="aclasswamp_1_1_payload_html_aa4b2975fe591e4fe69720904e6028f5e"><div class="ttname"><a href="classwamp_1_1_payload.html#aa4b2975fe591e4fe69720904e6028f5e">wamp::Payload::withArgs</a></div><div class="ttdeci">TDerived &amp; withArgs(Ts &amp;&amp;... args)</div><div class="ttdoc">Sets the positional arguments for this payload.</div></div>
<div class="ttc" id="aclasswamp_1_1_outcome_html"><div class="ttname"><a href="classwamp_1_1_outcome.html">wamp::Outcome</a></div><div class="ttdoc">Contains the outcome of an RPC invocation.</div><div class="ttdef"><b>Definition:</b> sessiondata.hpp:341</div></div>
<div class="ttc" id="aclasswamp_1_1_payload_html_ac0611ccca2da85479e1e8ac9b9a1618a"><div class="ttname"><a href="classwamp_1_1_payload.html#ac0611ccca2da85479e1e8ac9b9a1618a">wamp::Payload::args</a></div><div class="ttdeci">const Array &amp; args() const &amp;</div><div class="ttdoc">Accesses the constant list of positional arguments.</div><div class="ttdef"><b>Definition:</b> payload.hpp:156</div></div>
<div class="ttc" id="aclasswamp_1_1_result_html"><div class="ttname"><a href="classwamp_1_1_result.html">wamp::Result</a></div><div class="ttdoc">Contains a remote procedure result yielded by a callee or received by a caller.</div><div class="ttdef"><b>Definition:</b> sessiondata.hpp:305</div></div>
<div class="ttc" id="aclasswamp_1_1_registration_html"><div class="ttname"><a href="classwamp_1_1_registration.html">wamp::Registration</a></div><div class="ttdoc">Represents a remote procedure registration.</div><div class="ttdef"><b>Definition:</b> registration.hpp:43</div></div>
<div class="ttc" id="aclasswamp_1_1_outcome_html_a52926c1960018ba9769f6fb5d4be4c7d"><div class="ttname"><a href="classwamp_1_1_outcome.html#a52926c1960018ba9769f6fb5d4be4c7d">wamp::Outcome::deferred</a></div><div class="ttdeci">static Outcome deferred()</div><div class="ttdoc">Constructs an Outcome having Type::deferred.</div><div class="ttdef"><b>Definition:</b> sessiondata.ipp:518</div></div>
<div class="ttc" id="astructwamp_1_1error_1_1_conversion_html"><div class="ttname"><a href="structwamp_1_1error_1_1_conversion.html">wamp::error::Conversion</a></div><div class="ttdoc">Exception type thrown when converting a Variant to an invalid type.</div><div class="ttdef"><b>Definition:</b> error.hpp:105</div></div>
<div class="ttc" id="anamespacewamp_html_a5a79c4206c6e45fbfedc0d7d4a775890a534735884d341071762ede7af01c53e8"><div class="ttname"><a href="namespacewamp.html#a5a79c4206c6e45fbfedc0d7d4a775890a534735884d341071762ede7af01c53e8">wamp::CancelMode::kill</a></div><div class="ttdeci">@ kill</div><div class="ttdoc">INTERRUPT sent to callee; RESULT or ERROR returned, depending on callee.</div></div>
<div class="ttc" id="aclasswamp_1_1_invocation_html"><div class="ttname"><a href="classwamp_1_1_invocation.html">wamp::Invocation</a></div><div class="ttdoc">Contains payload arguments and other details related to a remote procedure call invocation.</div><div class="ttdef"><b>Definition:</b> sessiondata.hpp:424</div></div>
<div class="ttc" id="aclasswamp_1_1_cancellation_html"><div class="ttname"><a href="classwamp_1_1_cancellation.html">wamp::Cancellation</a></div><div class="ttdoc">Contains the request ID and options passed to Session::cancel.</div><div class="ttdef"><b>Definition:</b> sessiondata.hpp:288</div></div>
<div class="ttc" id="anamespacewamp_html_a9dd954da85bf9033739185b3a29e3e85"><div class="ttname"><a href="namespacewamp.html#a9dd954da85bf9033739185b3a29e3e85">wamp::AsioContext</a></div><div class="ttdeci">boost::asio::io_context AsioContext</div><div class="ttdoc">Queues and runs I/O completion handlers.</div><div class="ttdef"><b>Definition:</b> asiodefs.hpp:29</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="_tutorial.html">Tutorial</a></li>
    <li class="footer">Generated on Sun May 15 2022 01:42:06 for CppWAMP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
