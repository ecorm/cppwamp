<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CppWAMP: Registrations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CppWAMP
   </div>
   <div id="projectbrief">C++11 client library for the WAMP protocol</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_registrations.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Registrations </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#CallSlots">Call Slots</a></li>
<li class="level1"><a href="#SimpleCallSlots">Simple Call Slots</a></li>
<li class="level1"><a href="#SimpleCoroutineCallSlots">Simple Coroutine Call Slots</a></li>
<li class="level1"><a href="#UnpackedCallSlots">Unpacked Call Slots</a></li>
<li class="level1"><a href="#UnpackedCoroutineCallSlots">Unpacked Coroutine Call Slots</a></li>
<li class="level1"><a href="#RpcOutcomes">RPC Outcomes</a><ul><li class="level2"><a href="#ResultOutcomes">Result Outcomes</a></li>
<li class="level2"><a href="#ErrorOutcomes">Error Outcomes</a></li>
<li class="level2"><a href="#DeferredOutcomes">Deferred Outcomes</a></li>
</ul>
</li>
<li class="level1"><a href="#ScopedRegistrations">Scoped Registrations</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="CallSlots"></a>
Call Slots</h1>
<p>A <em>slot</em> is a <em>callable target</em> that is called in response to a <em>signal</em> (the signal being the call invocation in this case). The term <em>slot</em>, borrowed from <a href="http://doc.qt.io/qt-5/signalsandslots.html">Qt's signals and slots</a>, is used to distinguish a call handler from an asynchronous operation handler.</p>
<p>A <em>callable target</em> can be:</p><ul>
<li>a free function,</li>
<li>a bound member function (using <code>std::bind</code>),</li>
<li>a function object,</li>
<li>a lambda function, etc.</li>
</ul>
<p>A <em>call slot</em> represents an RPC handler that does not have any expectations on the invocation payload arguments. If necessary, the payload arguments must be checked during runtime, in the body of the call handler.</p>
<p><a class="el" href="classwamp_1_1_session.html#a63584862689bbb1c9a6eb02f166b2f1d" title="Registers a WAMP remote procedure call.">wamp::Session::enroll</a> expects a call slot with the following signature:</p>
<div class="fragment"><div class="line"><a class="code" href="classwamp_1_1_outcome.html">wamp::Outcome</a> <span class="keyword">function</span>(<a class="code" href="classwamp_1_1_invocation.html">wamp::Invocation</a>)</div>
</div><!-- fragment --><p>where:</p><ul>
<li><a class="el" href="classwamp_1_1_outcome.html" title="Contains the outcome of an RPC invocation.">wamp::Outcome</a> contains a <a class="el" href="classwamp_1_1_result.html" title="Contains the remote procedure result options/payload within WAMP RESULT and YIELD messages.">wamp::Result</a> or a <a class="el" href="classwamp_1_1_error.html" title="Provides the reason URI, options, and payload arguments contained within WAMP ERROR messages.">wamp::Error</a> object to be sent back to the caller, and,</li>
<li><a class="el" href="classwamp_1_1_invocation.html" title="Contains payload arguments and other options within WAMP INVOCATION messages.">wamp::Invocation</a> is an object containing information and payload arguments related to the RPC invocation.</li>
</ul>
<p>The following table summarizes the different types of call slots that can be used with the library:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Slot Type </th><th class="markdownTableHeadNone">Wrapper Function </th><th class="markdownTableHeadNone">Slot Signature  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="_registrations.html#SimpleCallSlots">Simple Call Slot</a> </td><td class="markdownTableBodyNone"><code>wamp::simpleRpc&lt;TResult, TArgs...&gt;</code> </td><td class="markdownTableBodyNone"><code>TResult function(TArgs...)</code>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="_registrations.html#SimpleCoroutineCallSlots">Simple Coroutine Call Slot</a> </td><td class="markdownTableBodyNone"><code>wamp::simpleCoroRpc&lt;TResult, TArgs...&gt;</code> </td><td class="markdownTableBodyNone"><code>TResult function(TArgs..., Yield)</code>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="_registrations.html#UnpackedCallSlots">Unpacked Call Slot</a> </td><td class="markdownTableBodyNone"><code>wamp::unpackedRpc&lt;TArgs...&gt;</code> </td><td class="markdownTableBodyNone"><code>Outcome function(Invocation, TArgs...)</code>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="_registrations.html#UnpackedCoroutineCallSlots">Unpacked Coroutine Call Slot</a> </td><td class="markdownTableBodyNone"><code>wamp::unpackedCoroRpc&lt;TArgs...&gt;</code> </td><td class="markdownTableBodyNone"><code>Outcome function(Invocation, TArgs..., Yield)</code>  </td></tr>
</table>
<p>where <code>Yield</code> represents the type <code>boost::asio::yield_context</code>.</p>
<h1><a class="anchor" id="SimpleCallSlots"></a>
Simple Call Slots</h1>
<p>A <em>simple call slot</em> represents an RPC handler that expects one or more payload arguments having specific, static types. The <a class="el" href="classwamp_1_1_simple_invocation_unpacker.html#a414a1fa8c01375d2441c767b30ce6c1c">wamp::simpleRpc</a> function can be used when registering such call slots. It takes a simple call slot, and converts it into a regular call slot that can be passed to <a class="el" href="classwamp_1_1_session.html#a63584862689bbb1c9a6eb02f166b2f1d" title="Registers a WAMP remote procedure call.">wamp::Session::enroll</a>.</p>
<p><code>wamp::simpleRpc</code> expects a call slot with the following signature:</p>
<div class="fragment"><div class="line">TResult <span class="keyword">function</span>(TArgs...)</div>
</div><!-- fragment --><p>where</p><ul>
<li><code>TResult</code> is a static return type that will be automatically converted to a single <a class="el" href="classwamp_1_1_result.html" title="Contains the remote procedure result options/payload within WAMP RESULT and YIELD messages.">wamp::Result</a> payload argument and then returned as a <a class="el" href="classwamp_1_1_outcome.html" title="Contains the outcome of an RPC invocation.">wamp::Outcome</a>. This return type may be <code>void</code> if the RPC is not expected to return a value.</li>
<li><code>TArgs...</code> matches the template parameter pack that was passed to <code>wamp::simpleRpc</code>.</li>
</ul>
<p>Examples of simple call slots are: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> setSpeed(<span class="keywordtype">float</span> speed) { ... }</div>
<div class="line"><span class="comment">// ^            ^</span></div>
<div class="line"><span class="comment">// TResult    TArgs</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> purchase(std::string item, <span class="keywordtype">int</span> cost, <span class="keywordtype">int</span> qty) { ... }</div>
<div class="line"><span class="comment">//^                  ^          ^         ^</span></div>
<div class="line"><span class="comment">// \                 \----------|---------/</span></div>
<div class="line"><span class="comment">// TResult                    TArgs</span></div>
</div><!-- fragment --><p>The above slots can be registered as follows: </p><div class="fragment"><div class="line">session-&gt;enroll(Procedure(<span class="stringliteral">&quot;setSpeed&quot;</span>),</div>
<div class="line">                simpleRpc&lt;void, float&gt;(&amp;setSpeed),</div>
<div class="line">                handler);</div>
<div class="line"> </div>
<div class="line">session-&gt;enroll(Procedure(<span class="stringliteral">&quot;purchase&quot;</span>),</div>
<div class="line">                simpleRpc&lt;int, std::string, int, int&gt;(&amp;purchase),</div>
<div class="line">                handler);</div>
</div><!-- fragment --><p>where <code>handler</code> is the asynchronous handler (or coroutine yield context) for the <b>enroll operation itself</b>.</p>
<p>Whenever a <a class="el" href="classwamp_1_1_session.html" title="Session API used by a client peer in WAMP applications.">wamp::Session</a> dispatches an RPC invocation to the above slots, it automatically unpacks the invocation payload positional arguments, and passes them to the slot's argument list. If <code>Session</code> cannot convert the invocation payload arguments to their target types, it automatically sends an <code>ERROR</code> reply back to the router.</p>
<h1><a class="anchor" id="SimpleCoroutineCallSlots"></a>
Simple Coroutine Call Slots</h1>
<p>A <em>simple coroutine call slot</em> is like a regular <em>simple call slot</em>, except that it is executed within the context of a coroutine. This is useful for RPC handlers that need to perform asynchronous operations themselves. The <a class="el" href="classwamp_1_1_simple_coro_invocation_unpacker.html#a61f623e2a822b64632f9e7959425972a">wamp::simpleCoroRpc</a> function can be used when registering such call slots. It takes a simple coroutine call slot, and converts it into a regular call slot that can be passed to <a class="el" href="classwamp_1_1_session.html#a63584862689bbb1c9a6eb02f166b2f1d" title="Registers a WAMP remote procedure call.">wamp::Session::enroll</a>.</p>
<p><code>wamp::simpleCoroRpc</code> expects a call slot with the following signature:</p>
<div class="fragment"><div class="line">TResult <span class="keyword">function</span>(TArgs..., boost::asio::yield_context)</div>
</div><!-- fragment --><p>where</p><ul>
<li><code>TResult</code> is a static return type that will be automatically converted to a single <a class="el" href="classwamp_1_1_result.html" title="Contains the remote procedure result options/payload within WAMP RESULT and YIELD messages.">wamp::Result</a> payload argument and then returned as a <a class="el" href="classwamp_1_1_outcome.html" title="Contains the outcome of an RPC invocation.">wamp::Outcome</a>. This return type may be <code>void</code> if the RPC is not expected to return a value.</li>
<li><code>TArgs...</code> matches the template parameter pack that was passed to <code>wamp::simpleCoroRpc</code>.</li>
<li><code>boost::asio::yield_context</code> represents the RPC's coroutine context.</li>
</ul>
<p>Examples of simple coroutine call slots are: </p><div class="fragment"><div class="line"><span class="keyword">using</span> Yield = boost::asio::yield_context;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setSpeed(<span class="keywordtype">float</span> speed, Yield yield) { ... }</div>
<div class="line"><span class="comment">// ^            ^</span></div>
<div class="line"><span class="comment">// TResult    TArgs</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> purchase(std::string item, <span class="keywordtype">int</span> cost, <span class="keywordtype">int</span> qty, Yield yield) { ... }</div>
<div class="line"><span class="comment">//^                  ^          ^         ^</span></div>
<div class="line"><span class="comment">// \                 \----------|---------/</span></div>
<div class="line"><span class="comment">// TResult                    TArgs</span></div>
</div><!-- fragment --><p>The above slots can be registered as follows: </p><div class="fragment"><div class="line">session-&gt;enroll(Procedure(<span class="stringliteral">&quot;setSpeed&quot;</span>),</div>
<div class="line">                simpleCoroRpc&lt;void, float&gt;(&amp;setSpeed),</div>
<div class="line">                handler);</div>
<div class="line"> </div>
<div class="line">session-&gt;enroll(Procedure(<span class="stringliteral">&quot;purchase&quot;</span>),</div>
<div class="line">                simpleCoroRpc&lt;int, std::string, int, int&gt;(&amp;purchase),</div>
<div class="line">                handler);</div>
</div><!-- fragment --><p>where <code>handler</code> is the asynchronous handler (or coroutine yield context) for the <b>enroll operation itself</b>.</p>
<p>Whenever a <a class="el" href="classwamp_1_1_session.html" title="Session API used by a client peer in WAMP applications.">wamp::Session</a> dispatches an RPC invocation to the above slots, it spawns a new coroutine to be executed on <a class="el" href="classwamp_1_1_session.html#a81982d14db9a74785a2f471c6a3cad5c" title="Legacy function kept for backward compatiblity.">wamp::Session::userIosvc()</a>. It then automatically unpacks the invocation payload positional arguments, and passes them to the slot's argument list. If <code>Session</code> cannot convert the invocation payload arguments to their target types, it automatically sends an <code>ERROR</code> reply back to the router.</p>
<h1><a class="anchor" id="UnpackedCallSlots"></a>
Unpacked Call Slots</h1>
<p>An <em>unpacked call slot</em> represents an RPC handler that expects one or more payload arguments having specific, static types. The <a class="el" href="classwamp_1_1_invocation_unpacker.html#a87bb179c90a4278ff5f14319da09fb5c">wamp::unpackedRpc</a> function can be used when registering such call slots. It takes an unpacked call slot, and converts it into a regular call slot that can be passed to <a class="el" href="classwamp_1_1_session.html#a63584862689bbb1c9a6eb02f166b2f1d" title="Registers a WAMP remote procedure call.">wamp::Session::enroll</a>.</p>
<p><code>wamp::unpackedRpc</code> expects a call slot with the following signature:</p>
<div class="fragment"><div class="line"><a class="code" href="classwamp_1_1_outcome.html">wamp::Outcome</a> <span class="keyword">function</span>(<a class="code" href="classwamp_1_1_invocation.html">wamp::Invocation</a>, TArgs...)</div>
</div><!-- fragment --><p>where</p><ul>
<li><a class="el" href="classwamp_1_1_outcome.html" title="Contains the outcome of an RPC invocation.">wamp::Outcome</a> contains a <a class="el" href="classwamp_1_1_result.html" title="Contains the remote procedure result options/payload within WAMP RESULT and YIELD messages.">wamp::Result</a> or a <a class="el" href="classwamp_1_1_error.html" title="Provides the reason URI, options, and payload arguments contained within WAMP ERROR messages.">wamp::Error</a> object to be sent back to the caller,</li>
<li><a class="el" href="classwamp_1_1_invocation.html" title="Contains payload arguments and other options within WAMP INVOCATION messages.">wamp::Invocation</a> is an object containing information and payload arguments related to the RPC invocation, and,</li>
<li><code>TArgs...</code> matches the template parameter pack that was passed to <code>wamp::unpackedRpc</code>.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Unpacked call slots differ from simple call slots in the following ways:<ul>
<li>Unpacked call slots are passed a <a class="el" href="classwamp_1_1_invocation.html" title="Contains payload arguments and other options within WAMP INVOCATION messages.">wamp::Invocation</a> object, which contains metadata on the call invocation itself. It also allows the slot to manually send a <code>YIELD</code> message back to the caller in a separate asynchronous task.</li>
<li>Unpacked call slots are expected to return a <a class="el" href="classwamp_1_1_outcome.html" title="Contains the outcome of an RPC invocation.">wamp::Outcome</a> object. This allows such slots to return <a class="el" href="namespacewamp.html#ab9817fe38224a0e5fc43ca9cdbce4716" title="Convenient value of the wamp::Deferment tag type that can be passed to the wamp::Outcome constructor.">wamp::deferment</a>, which indicates to the library that the callee will manually send (or has already sent) a <code>YIELD</code> message back to the caller.</li>
</ul>
</dd></dl>
<p>Examples of unpacked call slots are: </p><div class="fragment"><div class="line">Outcome setSpeed(Invocation inv, <span class="keywordtype">float</span> speed) { ... }</div>
<div class="line"><span class="comment">//                                 ^</span></div>
<div class="line"><span class="comment">//                               TArgs</span></div>
<div class="line"> </div>
<div class="line">Outcome purchase(Invocation inv, std::string item, <span class="keywordtype">int</span> cost, <span class="keywordtype">int</span> qty) { ... }</div>
<div class="line"><span class="comment">//                                       ^          ^         ^</span></div>
<div class="line"><span class="comment">//                                       \----------|---------/</span></div>
<div class="line"><span class="comment">//                                                TArgs</span></div>
</div><!-- fragment --><p>The above slots can be registered as follows: </p><div class="fragment"><div class="line">session-&gt;enroll(Procedure(<span class="stringliteral">&quot;setSpeed&quot;</span>),</div>
<div class="line">                unpackedRpc&lt;float&gt;(&amp;setSpeed),</div>
<div class="line">                handler);</div>
<div class="line"> </div>
<div class="line">session-&gt;enroll(Procedure(<span class="stringliteral">&quot;purchase&quot;</span>),</div>
<div class="line">                unpackedRpc&lt;std::string, int, int&gt;(&amp;purchase),</div>
<div class="line">                handler);</div>
</div><!-- fragment --><p>where <code>handler</code> is the asynchronous handler (or coroutine yield context) for the <b>enroll operation itself</b>.</p>
<p>Whenever a <a class="el" href="classwamp_1_1_session.html" title="Session API used by a client peer in WAMP applications.">wamp::Session</a> dispatches an RPC invocation to the above slots, it automatically unpacks the invocation payload positional arguments, and passes them to the slot's argument list. If <code>Session</code> cannot convert the invocation payload arguments to their target types, it automatically sends an <code>ERROR</code> reply back to the router.</p>
<h1><a class="anchor" id="UnpackedCoroutineCallSlots"></a>
Unpacked Coroutine Call Slots</h1>
<p>An <em>unpacked coroutine call slot</em> is like an <a class="el" href="_registrations.html#UnpackedCallSlots">unpacked call slot</a>, except that the slot is executed within the context of a coroutine. The <a class="el" href="classwamp_1_1_coro_invocation_unpacker.html#aa2879f55e9df633da8185e80f3c7428f">wamp::unpackedCoroRpc</a> function can be used when registering such call slots.</p>
<p><code>wamp::unpackedCoroRpc</code> expects a call slot with the following signature:</p>
<div class="fragment"><div class="line"><a class="code" href="classwamp_1_1_outcome.html">wamp::Outcome</a> <span class="keyword">function</span>(<a class="code" href="classwamp_1_1_invocation.html">wamp::Invocation</a>, TArgs..., boost::asio::yield_context)</div>
</div><!-- fragment --><p>where</p><ul>
<li><a class="el" href="classwamp_1_1_outcome.html" title="Contains the outcome of an RPC invocation.">wamp::Outcome</a> contains a <a class="el" href="classwamp_1_1_result.html" title="Contains the remote procedure result options/payload within WAMP RESULT and YIELD messages.">wamp::Result</a> or a <a class="el" href="classwamp_1_1_error.html" title="Provides the reason URI, options, and payload arguments contained within WAMP ERROR messages.">wamp::Error</a> object to be sent back to the caller,</li>
<li><a class="el" href="classwamp_1_1_invocation.html" title="Contains payload arguments and other options within WAMP INVOCATION messages.">wamp::Invocation</a> is an object containing information and payload arguments related to the RPC invocation, and,</li>
<li><code>TArgs...</code> matches the template parameter pack that was passed to <code>wamp::unpackedRpc</code>.</li>
<li><code>boost::asio::yield_context</code> represents the RPC's coroutine context.</li>
</ul>
<h1><a class="anchor" id="RpcOutcomes"></a>
RPC Outcomes</h1>
<p>RPC call slots are required to return a <a class="el" href="classwamp_1_1_outcome.html" title="Contains the outcome of an RPC invocation.">wamp::Outcome</a> object. <code>Outcome</code> is a discriminated union (i.e. variant) that can contain either:</p><ul>
<li>a <a class="el" href="classwamp_1_1_result.html" title="Contains the remote procedure result options/payload within WAMP RESULT and YIELD messages.">wamp::Result</a> object, which contains positional/keyword return arguments,</li>
<li>a <a class="el" href="classwamp_1_1_error.html" title="Provides the reason URI, options, and payload arguments contained within WAMP ERROR messages.">wamp::Error</a> object, which contains an error URI and other error-related information, or,</li>
<li>none of the above, which means that the outcome is <em>deferred</em>.</li>
</ul>
<h2><a class="anchor" id="ResultOutcomes"></a>
Result Outcomes</h2>
<p>An RPC call slot can send a result back to the caller by returning a <a class="el" href="classwamp_1_1_result.html" title="Contains the remote procedure result options/payload within WAMP RESULT and YIELD messages.">wamp::Result</a> object:</p>
<div class="fragment"><div class="line">Outcome add(Invocation, <span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> Result().withArgs(a + b);</div>
<div class="line">}</div>
</div><!-- fragment --><p>If only positional <code>Variant</code> arguments need to be returned, they can be returned directly via a braced initializer list:</p>
<div class="fragment"><div class="line">Outcome add(Invocation, <span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> {a + b};</div>
<div class="line">}</div>
</div><!-- fragment --><p>If an empty result needs to be returned, an empty initializer list can be used:</p>
<div class="fragment"><div class="line">Outcome doSomething()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Do something...</span></div>
<div class="line">    <span class="keywordflow">return</span> {};</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="ErrorOutcomes"></a>
Error Outcomes</h2>
<p>An RPC call slot can send an error back to the caller by returning a <a class="el" href="classwamp_1_1_error.html" title="Provides the reason URI, options, and payload arguments contained within WAMP ERROR messages.">wamp::Error</a> object:</p>
<div class="fragment"><div class="line">Outcome divide(Invocation, <span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (b == 0)</div>
<div class="line">        <span class="keywordflow">return</span> Error(<span class="stringliteral">&quot;myapp.divide_by_zero&quot;</span>);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        <span class="keywordflow">return</span> {a/b};</div>
<div class="line">}</div>
</div><!-- fragment --><p>Instead of returning an <code>Error</code> object via the <code>Outcome</code> return parameter, a call slot can also throw an <code>Error</code> object as an exception. The library will catch such exceptions and will send a corresponding <code>ERROR</code> message back to the caller:</p>
<div class="fragment"><div class="line">Outcome divide(Invocation, <span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (b == 0)</div>
<div class="line">        <span class="keywordflow">throw</span> Error(<span class="stringliteral">&quot;myapp.divide_by_zero&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> {a/b};</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Thrown exception types other than <a class="el" href="classwamp_1_1_error.html" title="Provides the reason URI, options, and payload arguments contained within WAMP ERROR messages.">wamp::Error</a> are <em>not</em> handled by the library, and will result in the exception being rethrown by <code>boost::asio::io_service::run</code>.</dd></dl>
<h2><a class="anchor" id="DeferredOutcomes"></a>
Deferred Outcomes</h2>
<p>A <em>deferred</em> outcome means that the call slot does not return anything, and that measures will be taken by the callee to manually yield a <code>Result</code> or <code>Error</code> object back to the caller (via <a class="el" href="classwamp_1_1_invocation.html#a5c4de6b58fd50c2d5f5372e740d2b29a" title="Manually sends a YIELD result back to the callee.">wamp::Invocation::yield</a>). This can be useful when the call result can only be determined in a different asynchronous context.</p>
<p>Example: </p><div class="fragment"><div class="line">Outcome Client::addPerson(Invocation inv, <a class="code" href="namespacewamp.html#a2027fe57e4014c013dcbbc733a1c9a56">Object</a> person)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// We need to issue another RPC to the database service before we can</span></div>
<div class="line">    <span class="comment">// fulfill this RPC.</span></div>
<div class="line">    boost::asio::spawn(inv.executor(),</div>
<div class="line">        [<span class="keyword">this</span>, inv](boost::asio::yield_context yield)</div>
<div class="line">        {</div>
<div class="line">            auto dbResult = session_-&gt;call( Rpc(<span class="stringliteral">&quot;db.add&quot;</span>).withArgs(person),</div>
<div class="line">                                            yield );</div>
<div class="line">            <span class="comment">// Manually send the result back to the caller</span></div>
<div class="line">            auto personId = dbResult[0].to&lt;int&gt;();</div>
<div class="line">            inv.yield({personId});</div>
<div class="line">        });</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// We don&#39;t know the result yet as this point. Return a deferred outcome</span></div>
<div class="line">    <span class="comment">// to indicate that we&#39;ll send the result manually in a different</span></div>
<div class="line">    <span class="comment">// asynchronous context.</span></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="namespacewamp.html#ab9817fe38224a0e5fc43ca9cdbce4716">deferment</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="ScopedRegistrations"></a>
Scoped Registrations</h1>
<p>A <a class="el" href="classwamp_1_1_scoped_registration.html" title="Limits a Registration&#39;s lifetime to a particular scope.">wamp::ScopedRegistration</a> object can be used to limit a registration's lifetime to a particular scope. When a <code>ScopedRegistration</code> object is destroyed, it automatically unregisters the RPC. This helps in automating the lifetime management of RPC registrations using <a href="https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization">RAII</a> techniques.</p>
<p>Here's an example illustrating how <code>ScopedRegistration</code> can be used to manage the lifetime of several registrations:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacewamp.html">wamp</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Service <span class="comment">// One of several services using the same Session</span></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> start(<a class="code" href="classwamp_1_1_session.html#a3c66ba85a4fa50f8b85b15ba0c672384">Session::Ptr</a> session)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// The session has already connected and joined when this is called.</span></div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> r1 = session_-&gt;enroll(<a class="code" href="classwamp_1_1_procedure.html">Procedure</a>(<span class="stringliteral">&quot;sum&quot;</span>), &amp;Service::sum,</div>
<div class="line">                                   yield).value();</div>
<div class="line">        <span class="keyword">auto</span> r2 = session_-&gt;enroll(<a class="code" href="classwamp_1_1_procedure.html">Procedure</a>(<span class="stringliteral">&quot;prod&quot;</span>), &amp;Service::prod,</div>
<div class="line">                                   yield).value();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Store scoped registrations in private member</span></div>
<div class="line">        registrations_.push_back(r1);</div>
<div class="line">        registrations_.push_back(r2);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">static</span> <a class="code" href="classwamp_1_1_outcome.html">Outcome</a> sum(<a class="code" href="classwamp_1_1_invocation.html">Invocation</a> inv)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">float</span> x = 0;</div>
<div class="line">        <span class="keywordtype">float</span> y = 0;</div>
<div class="line">        inv.convertTo(x, y);</div>
<div class="line">        <span class="keywordflow">return</span> {x + y};</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <a class="code" href="classwamp_1_1_outcome.html">Outcome</a> prod(<a class="code" href="classwamp_1_1_invocation.html">Invocation</a> inv)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">float</span> x = 0;</div>
<div class="line">        <span class="keywordtype">float</span> y = 0;</div>
<div class="line">        inv.convertTo(x, y);</div>
<div class="line">        <span class="keywordflow">return</span> {x * y};</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// When the Service is destroyed, the stored elements will also be</span></div>
<div class="line">    <span class="comment">// destroyed, performing automatic unregistration for each registered RPC.</span></div>
<div class="line">    std::vector&lt;ScopedRegistration&gt; registrations_;</div>
<div class="line">};</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="anamespacewamp_html_a2027fe57e4014c013dcbbc733a1c9a56"><div class="ttname"><a href="namespacewamp.html#a2027fe57e4014c013dcbbc733a1c9a56">wamp::Object</a></div><div class="ttdeci">std::map&lt; String, Variant &gt; Object</div><div class="ttdoc">Variant bound type for maps of variants.</div><div class="ttdef"><b>Definition:</b> variantdefs.hpp:52</div></div>
<div class="ttc" id="aclasswamp_1_1_session_html_a3c66ba85a4fa50f8b85b15ba0c672384"><div class="ttname"><a href="classwamp_1_1_session.html#a3c66ba85a4fa50f8b85b15ba0c672384">wamp::Session::Ptr</a></div><div class="ttdeci">std::shared_ptr&lt; Session &gt; Ptr</div><div class="ttdoc">Shared pointer to a Session.</div><div class="ttdef"><b>Definition:</b> session.hpp:117</div></div>
<div class="ttc" id="aclasswamp_1_1_procedure_html"><div class="ttname"><a href="classwamp_1_1_procedure.html">wamp::Procedure</a></div><div class="ttdoc">Contains the procedure URI and other options contained within WAMP REGISTER messages.</div><div class="ttdef"><b>Definition:</b> peerdata.hpp:492</div></div>
<div class="ttc" id="anamespacewamp_html_ab9817fe38224a0e5fc43ca9cdbce4716"><div class="ttname"><a href="namespacewamp.html#ab9817fe38224a0e5fc43ca9cdbce4716">wamp::deferment</a></div><div class="ttdeci">constexpr Deferment deferment</div><div class="ttdoc">Convenient value of the wamp::Deferment tag type that can be passed to the wamp::Outcome constructor.</div><div class="ttdef"><b>Definition:</b> peerdata.hpp:703</div></div>
<div class="ttc" id="anamespacewamp_html"><div class="ttname"><a href="namespacewamp.html">wamp</a></div><div class="ttdef"><b>Definition:</b> anyhandler.hpp:36</div></div>
<div class="ttc" id="aclasswamp_1_1_outcome_html"><div class="ttname"><a href="classwamp_1_1_outcome.html">wamp::Outcome</a></div><div class="ttdoc">Contains the outcome of an RPC invocation.</div><div class="ttdef"><b>Definition:</b> peerdata.hpp:709</div></div>
<div class="ttc" id="aclasswamp_1_1_invocation_html"><div class="ttname"><a href="classwamp_1_1_invocation.html">wamp::Invocation</a></div><div class="ttdoc">Contains payload arguments and other options within WAMP INVOCATION messages.</div><div class="ttdef"><b>Definition:</b> peerdata.hpp:799</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Aug 13 2022 20:54:39 for CppWAMP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
