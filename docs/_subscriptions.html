<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CppWAMP: Subscriptions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CppWAMP
   </div>
   <div id="projectbrief">C++11 client library for the WAMP protocol</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_subscriptions.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Subscriptions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#EventSlots">Event Slots</a></li>
<li class="level1"><a href="#BasicEventSlots">Basic Event Slots</a></li>
<li class="level1"><a href="#BasicCoroutineEventSlots">Basic Coroutine Event Slots</a></li>
<li class="level1"><a href="#UnpackedEventSlots">Unpacked Event Slots</a></li>
<li class="level1"><a href="#UnpackedCoroutineEventSlots">Unpacked Coroutine Event Slots</a></li>
<li class="level1"><a href="#ScopedSubscriptions">Scoped Subscriptions</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="EventSlots"></a>
Event Slots</h1>
<p>A <em>slot</em> is a <em>callable target</em> that is called in response to a <em>signal</em> (the signal being the event topic in this case). The term <em>slot</em>, borrowed from <a href="http://doc.qt.io/qt-5/signalsandslots.html">Qt's signals and slots</a>, is used to distinguish an event handler from an asynchronous operation handler.</p>
<p>A <em>callable target</em> can be:</p><ul>
<li>a free function,</li>
<li>a bound member function (using <code>std::bind</code>),</li>
<li>a function object,</li>
<li>a lambda function, etc.</li>
</ul>
<p>An <em>event slot</em> represents an event handler that does not have any expectations on the event payload arguments. If necessary, the payload arguments must be checked during runtime, in the body of the event handler.</p>
<p><a class="el" href="classwamp_1_1_session.html#a93b8686842db786a7d065c601f75cb5a" title="Subscribes to WAMP pub/sub events having the given topic.">wamp::Session::subscribe</a> expects an event slot with the following signature:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <span class="keyword">function</span>(<a class="code" href="classwamp_1_1_event.html">wamp::Event</a>)</div>
</div><!-- fragment --><p>where <a class="el" href="classwamp_1_1_event.html" title="Represents a published event.">wamp::Event</a> is an object containing information and payload arguments related to the publication.</p>
<p>The following table summarizes the different types of event slots that can be used with the library:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Slot Type </th><th class="markdownTableHeadNone">Wrapper Function </th><th class="markdownTableHeadNone">Slot Signature  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="_subscriptions.html#BasicEventSlots">Basic Event Slot</a> </td><td class="markdownTableBodyNone"><code>wamp::basicEvent&lt;TArgs...&gt;</code> </td><td class="markdownTableBodyNone"><code>void function(TArgs...)</code>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="_subscriptions.html#BasicCoroutineEventSlots">Basic Coroutine Event Slot</a> </td><td class="markdownTableBodyNone"><code>wamp::basicCoroEvent&lt;TArgs...&gt;</code> </td><td class="markdownTableBodyNone"><code>void function(TArgs..., Yield)</code>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="_subscriptions.html#UnpackedEventSlots">Unpacked Event Slot</a> </td><td class="markdownTableBodyNone"><code>wamp::unpackedEvent&lt;TArgs...&gt;</code> </td><td class="markdownTableBodyNone"><code>void function(Event, TArgs...)</code>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="_subscriptions.html#UnpackedCoroutineEventSlots">Unpacked Coroutine Event Slot</a> </td><td class="markdownTableBodyNone"><code>wamp::unpackedCoroEvent&lt;TArgs...&gt;</code> </td><td class="markdownTableBodyNone"><code>void function(Event, TArgs..., Yield)</code>  </td></tr>
</table>
<p>where <code>Yield</code> represents the type <code>boost::asio::yield_context</code>.</p>
<h1><a class="anchor" id="BasicEventSlots"></a>
Basic Event Slots</h1>
<p>A <em>basic event slot</em> represents an event handler that expects one or more payload arguments having specific, static types. The <a class="el" href="classwamp_1_1_basic_event_unpacker.html#af97c4057327602f97b24433889f35a83">wamp::basicEvent</a> function can be used when registering such event slots. It takes a basic event slot, and converts it into a regular event slot that can be passed to <a class="el" href="classwamp_1_1_session.html#a93b8686842db786a7d065c601f75cb5a" title="Subscribes to WAMP pub/sub events having the given topic.">wamp::Session::subscribe</a>.</p>
<p><code>wamp::basicEvent</code> expects an event slot with the following signature:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <span class="keyword">function</span>(TArgs...)</div>
</div><!-- fragment --><p>where <code>TArgs...</code> matches the template parameter pack that was passed to <code>wamp::basicEvent</code>.</p>
<p>Examples of basic event slots are: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> onSensorSampled(<span class="keywordtype">float</span> value) { ... }</div>
<div class="line"><span class="comment">//                     ^</span></div>
<div class="line"><span class="comment">//                    TArgs</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> onPurchase(std::string item, <span class="keywordtype">int</span> cost, <span class="keywordtype">int</span> qty) { ... }</div>
<div class="line"><span class="comment">//                      ^          ^          ^</span></div>
<div class="line"><span class="comment">//                      \----------|----------/</span></div>
<div class="line"><span class="comment">//                               TArgs</span></div>
</div><!-- fragment --><p>The above slots can be registered as follows: </p><div class="fragment"><div class="line">session-&gt;subscribe(Topic(<span class="stringliteral">&quot;sensorSampled&quot;</span>),</div>
<div class="line">                   basicEvent&lt;float&gt;(&amp;onSensorSampled),</div>
<div class="line">                   handler);</div>
<div class="line"> </div>
<div class="line">session-&gt;subscribe(Topic(<span class="stringliteral">&quot;itemPurchased&quot;</span>),</div>
<div class="line">                   basicEvent&lt;std::string, int, int&gt;(&amp;onPurchase),</div>
<div class="line">                   handler);</div>
</div><!-- fragment --><p>where <code>handler</code> is the asynchronous handler (or coroutine yield context) for the <b>subscribe operation itself</b>.</p>
<p>Whenever a <a class="el" href="classwamp_1_1_session.html" title="Asynchronous session API used by a client peer in WAMP applications.">wamp::Session</a> dispatches an event to the above slots, it automatically unpacks the event payload positional arguments, and passes them to the slot's argument list. If <code>Session</code> cannot convert the event payload arguments to their target types, it issues a warning that can be captured via <a class="el" href="classwamp_1_1_session.html#a3af4c171dc1d0cb7b412adbd702528db" title="Sets the log handler for warnings.">wamp::Session::setWarningHandler</a>.</p>
<h1><a class="anchor" id="BasicCoroutineEventSlots"></a>
Basic Coroutine Event Slots</h1>
<p>A <em>basic coroutine event slot</em> is like a regular <em>basic event slot</em>, except that it is executed within the context of a coroutine. This is useful for event handlers that need to perform asynchronous operations themselves. The <a class="el" href="classwamp_1_1_basic_coro_event_unpacker.html#a31b0d734488df6af2e81c0dc38cca4bb">wamp::basicCoroEvent</a> function can be used when registering such event slots. It takes a basic coroutine event slot, and converts it into a regular event slot that can be passed to <a class="el" href="classwamp_1_1_session.html#a93b8686842db786a7d065c601f75cb5a" title="Subscribes to WAMP pub/sub events having the given topic.">wamp::Session::subscribe</a>.</p>
<p><code>wamp::basicCoroEvent</code> expects an event slot with the following signature:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <span class="keyword">function</span>(TArgs..., boost::asio::yield_context)</div>
</div><!-- fragment --><p>where</p><ul>
<li><code>TArgs...</code> matches the template parameter pack that was passed to <code>wamp::basicEvent</code>.</li>
<li><code>boost::asio::yield_context</code> represents the event handler's coroutine context.</li>
</ul>
<p>Examples of basic coroutine event slots are: </p><div class="fragment"><div class="line"><span class="keyword">using</span> Yield = boost::asio::yield_context;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> onSensorSampled(<span class="keywordtype">float</span> value, Yield yield) { ... }</div>
<div class="line"><span class="comment">//                     ^</span></div>
<div class="line"><span class="comment">//                    TArgs</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> onPurchase(std::string item, <span class="keywordtype">int</span> cost, <span class="keywordtype">int</span> qty, Yield yield) { ... }</div>
<div class="line"><span class="comment">//                      ^          ^          ^</span></div>
<div class="line"><span class="comment">//                      \----------|----------/</span></div>
<div class="line"><span class="comment">//                               TArgs</span></div>
</div><!-- fragment --><p>The above slots can be registered as follows: </p><div class="fragment"><div class="line">session-&gt;subscribe(Topic(<span class="stringliteral">&quot;sensorSampled&quot;</span>),</div>
<div class="line">                   basicCoroEvent&lt;float&gt;(&amp;onSensorSampled),</div>
<div class="line">                   handler);</div>
<div class="line"> </div>
<div class="line">session-&gt;subscribe(Topic(<span class="stringliteral">&quot;itemPurchased&quot;</span>),</div>
<div class="line">                   basicCoroEvent&lt;std::string, int, int&gt;(&amp;onPurchase),</div>
<div class="line">                   handler);</div>
</div><!-- fragment --><p>where <code>handler</code> is the asynchronous handler (or coroutine yield context) for the <b>subscribe operation itself</b>.</p>
<p>Whenever a <a class="el" href="classwamp_1_1_session.html" title="Asynchronous session API used by a client peer in WAMP applications.">wamp::Session</a> dispatches an event to the above slots, it spawns a new coroutine to be executed on <a class="el" href="classwamp_1_1_session.html#addd68e231676b0f2c1213d889916ca27" title="Legacy function kept for backward compatiblity.">wamp::Session::userIosvc()</a>. It then automatically unpacks the event payload positional arguments, and passes them to the slot's argument list. If <code>Session</code> cannot convert the event payload arguments to their target types, it issues a warning that can be captured via <a class="el" href="classwamp_1_1_session.html#a3af4c171dc1d0cb7b412adbd702528db" title="Sets the log handler for warnings.">wamp::Session::setWarningHandler</a>.</p>
<h1><a class="anchor" id="UnpackedEventSlots"></a>
Unpacked Event Slots</h1>
<p>An <em>unpacked event slot</em> represents an event handler that expects one or more payload arguments having specific, static types. The <a class="el" href="classwamp_1_1_event_unpacker.html#a3a5936cee7324fa48beedded9745f1f0">wamp::unpackedEvent</a> function can be used when registering such event slots. It takes an unpacked event slot, and converts it into a regular event slot that can be passed to <a class="el" href="classwamp_1_1_session.html#a93b8686842db786a7d065c601f75cb5a" title="Subscribes to WAMP pub/sub events having the given topic.">wamp::Session::subscribe</a>.</p>
<p><code>wamp::unpackedEvent</code> expects an event slot with the following signature:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <span class="keyword">function</span>(<a class="code" href="classwamp_1_1_event.html">wamp::Event</a>, TArgs...)</div>
</div><!-- fragment --><p>where</p><ul>
<li><a class="el" href="classwamp_1_1_event.html" title="Represents a published event.">wamp::Event</a> is an object containing information and payload arguments related to the publication, and,</li>
<li><code>TArgs...</code> matches the template parameter pack that was passed to <code>wamp::unpackedEvent</code>.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Unpacked event slots differ from basic event slots in the following way: Unpacked event slots are passed a <a class="el" href="classwamp_1_1_event.html" title="Represents a published event.">wamp::Event</a> object, which contains metadata on the event itself.</dd></dl>
<p>Examples of unpacked event slots are: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> onSensorSampled(Event event, <span class="keywordtype">float</span> value) { ... }</div>
<div class="line"><span class="comment">//                                  ^</span></div>
<div class="line"><span class="comment">//                                TArgs</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> onPurchase(Event event, std::string item, <span class="keywordtype">int</span> cost, <span class="keywordtype">int</span> qty) { ... }</div>
<div class="line"><span class="comment">//                                  ^          ^          ^</span></div>
<div class="line"><span class="comment">//                                  \----------|----------/</span></div>
<div class="line"><span class="comment">//                                           TArgs</span></div>
</div><!-- fragment --><p>The above slots can be registered as follows: </p><div class="fragment"><div class="line">session-&gt;subscribe(Topic(<span class="stringliteral">&quot;sensorSampled&quot;</span>),</div>
<div class="line">                   unpackedEvent&lt;float&gt;(&amp;onSensorSampled),</div>
<div class="line">                   handler);</div>
<div class="line"> </div>
<div class="line">session-&gt;subscribe(Topic(<span class="stringliteral">&quot;itemPurchased&quot;</span>),</div>
<div class="line">                   unpackedEvent&lt;std::string, int, int&gt;(&amp;onPurchase),</div>
<div class="line">                   handler);</div>
</div><!-- fragment --><p>where <code>handler</code> is the asynchronous handler (or coroutine yield context) for the <b>subscribe operation itself</b>.</p>
<p>Whenever a <a class="el" href="classwamp_1_1_session.html" title="Asynchronous session API used by a client peer in WAMP applications.">wamp::Session</a> dispatches an event to the above slots, it automatically unpacks the event payload positional arguments, and passes them to the slot's argument list. If <code>Session</code> cannot convert the event payload arguments to their target types, it issues a warning that can be captured via <a class="el" href="classwamp_1_1_session.html#a3af4c171dc1d0cb7b412adbd702528db" title="Sets the log handler for warnings.">wamp::Session::setWarningHandler</a>.</p>
<h1><a class="anchor" id="UnpackedCoroutineEventSlots"></a>
Unpacked Coroutine Event Slots</h1>
<p>An <em>unpacked coroutine event slot</em> is like an <a class="el" href="_subscriptions.html#UnpackedEventSlots">unpacked event slot</a>, except that the slot is executed within the context of a coroutine. The <a class="el" href="classwamp_1_1_coro_event_unpacker.html#ab3de2e5798ac4ef58ce0b5c4163b5501">wamp::unpackedCoroEvent</a> function can be used when registering such event slots.</p>
<p><code>wamp::unpackedCoroEvent</code> expects an event slot with the following signature:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <span class="keyword">function</span>(<a class="code" href="classwamp_1_1_event.html">wamp::Event</a>, TArgs..., boost::asio::yield_context)</div>
</div><!-- fragment --><p>where</p><ul>
<li><a class="el" href="classwamp_1_1_event.html" title="Represents a published event.">wamp::Event</a> is an object containing information and payload arguments related to the publication, and,</li>
<li><code>TArgs...</code> matches the template parameter pack that was passed to <code>wamp::unpackedEvent</code>.</li>
<li><code>boost::asio::yield_context</code> represents the event handler's coroutine context.</li>
</ul>
<h1><a class="anchor" id="ScopedSubscriptions"></a>
Scoped Subscriptions</h1>
<p>A <a class="el" href="classwamp_1_1_scoped_subscription.html" title="Limits a Subscription&#39;s lifetime to a particular scope.">wamp::ScopedSubscription</a> object can be used to limit a subscription's lifetime to a particular scope. When a <code>ScopedSubscription</code> object is destroyed, it automatically unsubscribes the subscription. This helps in automating the lifetime management of topic subscriptions using RAII techniques.</p>
<p>Here's an example illustrating how <code>ScopedSubscription</code> can be used to manage the lifetime of a subscription:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Observer</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">void</span> onEvent(Event event);</div>
<div class="line"> </div>
<div class="line">    ScopedSubscription sub;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    boost::asio::io_service iosvc;</div>
<div class="line">    boost::asio::spawn(iosvc, [&amp;](boost::asio::yield_context yield)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> session = CoroSession&lt;&gt;::create(connectorList);</div>
<div class="line">        session-&gt;connect(yield);</div>
<div class="line">        session-&gt;join(<span class="stringliteral">&quot;somerealm&quot;</span>, yield);</div>
<div class="line"> </div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">using</span> std::placeholders;</div>
<div class="line">            Observer observer;</div>
<div class="line">            observer.sub = session-&gt;subscribe(</div>
<div class="line">                            Topic(<span class="stringliteral">&quot;sometopic&quot;</span>),</div>
<div class="line">                            std::bind(&amp;Observer::onEvent, observer, _1),</div>
<div class="line">                            yield);</div>
<div class="line"> </div>
<div class="line">        }  <span class="comment">// When the &#39;observer&#39; object leaves this scope, its</span></div>
<div class="line">           <span class="comment">// ScopedSubscription member gets destroyed. This will</span></div>
<div class="line">           <span class="comment">// automatically unsubscribe the subscription, thereby avoiding</span></div>
<div class="line">           <span class="comment">// further member function calls on the deleted &#39;observer&#39; object.</span></div>
<div class="line">    });</div>
<div class="line">    iosvc.run();</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aclasswamp_1_1_event_html"><div class="ttname"><a href="classwamp_1_1_event.html">wamp::Event</a></div><div class="ttdoc">Represents a published event.</div><div class="ttdef"><b>Definition:</b> sessiondata.hpp:181</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun May 15 2022 01:42:06 for CppWAMP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
